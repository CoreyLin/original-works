> 如想了解更多内容，请关注微信公众号“Corey区块链技术分享”。

本文分享我个人对Hyperledger Fabric中数据隔离、数据隐私、数据加密的理解，侧重于理论，实际的技术实施后续通过其他博客来分享。

## 数据隔离

在Hyperledger Fabric中，谈数据隔离，一定会谈到一个概念：channel（通道），这是Fabric数据隔离的基础。一个通道是两个或多个特定网络成员之间通信的私有“子网”，用于进行私有和机密交易。通道由组织、每个组织的锚peer、共享账本、链码应用程序以及排序服务节点定义。网络上的每个交易都在一个通道上执行，其中每一方都必须通过身份认证和授权才能在该通道上进行交易处理。每个加入通道的peer都有其由MSP提供的身份。

每个通道有自己的账本，和其他通道的账本互相隔离。账本存在于通道的范围内——它可以在整个网络中共享(假设每个参与者都在一个公共通道上运行)——或者可以将账本私有化，只包含特定的组织。数据的传播，包括交易信息、账本状态和通道成员关系，仅局限于在通道上具有可验证成员关系的peer中。

这种按通道隔离peer和账本数据的做法允许需要私有和机密交易的网络成员（组织）与商业竞争对手在同一个区块链网络上共存。

所以通道的概念和联盟链的概念是天然结合在一起的。有了通道，不同的竞争对手（组织）可以在不同的通道里进行交易，互不影响。

## 数据隐私

由通道引入的数据隔离已经从很大程度上解决了数据隐私的问题，但解决的是粒度比较粗的数据隐私问题。还存在更加细粒度的数据隐私问题，这需要举个例子才能更加清楚地说明。

假设一个通道上有5个组织，它们交易苹果:

* 一个农民：种植苹果，把苹果卖给经销商，通过经销商卖到国外

* 一个经销商：把苹果卖给出口商，再由出口商卖给批发商

* 一个出口商：从经销商买苹果，然后卖给批发商；或者从经销商买苹果，直接卖给零售商

* 一个批发商：通过出口商购买经销商的苹果

* 一个零售商：从批发商或者出口商购买苹果

首先，由于这些组织在业务上的交易关系都是紧密相连的，且比较复杂，所以我们把这些组织全部放到一个通道中是很合理的。这样的话做到了数据隔离，比如，这个通道中的批发商和其他批发商（竞争对手）不在一个通道中，数据不共享，实现了天然的隔离。

但是，一个通道中的组织在商业上可能有一些更细粒度的数据隐私的需求，比如：

* 经销商可能希望与农民和出口商进行私下交易，使得他们之间的交易条款对于批发商和零售商是保密的，从而以免暴露他们在把苹果卖给批发商或者零售商收取的加价。

* 经销商可能还希望与批发商建立单独的私有数据关系，因为它向批发商收取的价格低于它向零售商收取的价格。

总之，在一个通道内的不同组织之间，都存在各种各样的更细粒度的数据隐私和保密的需求。为了解决这种粒度的隐私需求，我们不应该为每个隐私数据关系定义许多小通道，而是应该定义多个private data collections (PDC，私有数据集合)，使用PDC在一个通道的基础上进一步隔离数据，使PDC在逻辑上与通道账本相分离，仅可由授权的组织子集访问。比如为经销商、农民、出口商定义一个单独的PDC，这三者之间的隐私数据可以写到这个PDC上，仅能够被经销商、农民、出口商访问；为经销商和批发商定义一个单独的PDC，这两者之间的隐私数据可以写到这个PDC上，仅能够被经销商和批发商访问。各个PDC不共享数据，互不干涉，互不影响，这样的话就可以让各个组织在一个通道的前提下实现更加细粒度的数据隐私的业务需求，这对于真实商业场景的私有和机密的多方交易是非常有意义的。通道使交易在更广泛的网络中保持私有，而PDC使通道上的组织子集之间的数据保持私有。

具体的技术实现后续通过另一篇博客来分享。

## 数据加密

在用通道以及私有数据集合实现了数据隔离和数据隐私之后，还存在一种更进一步的数据隐私的需求，即某些商业数据的机密性非常高，比如某些非常敏感的价格数据，或者个人身份证号、社保卡号等信息，需要更强的保密。在这种场景下，为了进一步对数据进行保密，可以在将交易发送到排序服务并向账本添加区块之前，使用通用的加密算法(如AES)对链码中的值进行部分加密或全部加密。一旦加密的数据写入到账本中，只有拥有生成加密数据的对应密钥的用户才能解密该数据，也就是说只有拥有密钥的组织才能解密并查看数据。

这里又引入了一个加密密钥的概念：在AES中，对明文加密需要一个密钥，解密同样需要这个密钥，加密和解密的密钥是相同的。这个密钥的存储是一个问题，是存在一个单独的off-chain的数据库上，还是就存在区块链上。个人认为把AES密钥通过前述的私有数据集合（PDC）存在区块链上是上佳之选，因为避免了引入单独的off-chain的数据库的技术复杂性，也实现了只让指定的部分组织有权限访问AES密钥的目的。

具体的技术实现后续通过另一篇博客来分享。

> 如想了解更多内容，请关注微信公众号“Corey区块链技术分享”。
